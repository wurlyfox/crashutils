#ifndef TEXTURE_BUFFER_H
#define TEXTURE_BUFFER_H

#include "types.h"

#include "../crash/nsd.h"
#include "../crash/nsf.h"
#include "../crash/r3000a.h"

#define MAX_TEXTURES  8           //max texture chunks
//#define PAGE_WIDTH  512
//#define PAGE_HEIGHT 128

#define CACHE_SIZE_TEXTURE 16384  //24K
#define SUBTEXBLOCK_SPACE 4096

#define RGBA(r,g,b,a) ((r)|(g << 8)|(b << 16)|(a << 24))

typedef struct
{
  unsigned short coords:10;
  unsigned short colorMode:1;
  unsigned short offsetX:5;
  
  unsigned short offsetY:5;
  unsigned short sect128:2;
  unsigned short clutIndex:4;
  unsigned short clutPalette:4;
    
  unsigned short chunkIndex:4;
  unsigned short subTexture:12; 
} textureEntry, textureCacheEntry;

typedef struct
{
  unsigned short X;  
  unsigned short Y;
  textureEntry *texEntry;
} subTextureBlock;

typedef struct 
{
  unsigned short allocBlocks;
  unsigned short  usedBlocks;
  subTextureBlock *blocks;
} subTextureGroup;

class texture_buffer
{
  protected:
	
	NSF *nsf;
	NSD *nsd;
	
  int subTextureCount;
	texture subTextures[1025];
  textureCacheEntry textureCache[CACHE_SIZE_TEXTURE];
  textureCacheEntry *textureCacheSorted[CACHE_SIZE_TEXTURE];

  int numSubTextureBlocks;
  subTextureGroup subTexGroups[25];

	int clutCount;
  unsigned long cluts[MAX_TEXTURES][16][256];

	void initTextures();	
	void initCluts();
  
	bool splitBlock(int srcGroup, int dstGroup);
	bool combineBlocks(int srcGroup, int dstGroup, point2 loc);
	unsigned short addFreeBlock(int dstGroup, point2 loc);
	bool getFreeBlocks(int srcGroup, int dstGroup, point2 &loc);
	
  void getCoords(int index, point &A, point &B, point &C, point &D);
	bool subTexturePixels(textureEntry *tex, unsigned long *pixBuf);
  virtual void subTextureCreate(textureCacheEntry *tex);

  void addClut(unsigned char chunkIndex, unsigned char clutIndex);
  
	public:
  
	texture_buffer() {};
	texture_buffer(NSD *_nsd, NSF *_nsf)
	{
	  nsd = _nsd;
		nsf = _nsf;
		
		initAll();
  }
  ~texture_buffer()
  {
    for (int lp = 0; lp < 25; lp++)
      free(subTexGroups[lp].blocks);
  }

  void setNSDNSF(NSD *_nsd, NSF *_nsf)
  {
    nsd = _nsd;
    nsf = _nsf;
  }

	void initAll();
  
  //-implement:
  //any texture hardware initialization in init()
  //function to store a specified 'texture' block of pixels of specified width and 
  // height at the specified x,y location in memory (i.e. in vram)
  //function to return the 'texture coordinate' equivalent of the rectangular region
  // with given corners at the 4 respective points in memory (i.e. in vram)
	virtual void init() {};
	virtual void storeBlock(unsigned long *pixBuf, int x, int y, int w, int h) {};
	virtual fquad2 getBlockCoords(point A, point B, point C, point D) {};
	
	void resetTextures();
	void initTextureCache();
	void initSubtextureGroups(bool reallocate);

	unsigned char getTextureChunk(unsigned long EID);	
	texture *getTexture(textureEntry *texEntry);
  texture *allocTexture() { return &subTextures[subTextureCount++]; } 
};

const unsigned short texCoords[600][4] = 
{ 
    //upper left right triangle [(0,0)-(x,0)-(0,y)-(x,y)]
    { 0, 3, 0x300, 0x303 },     //4x4      
    { 0, 7, 0x300, 0x307 },     //4x8
    { 0, 0xF, 0x300, 0x30F },   //4x16
    { 0, 0x1F, 0x300, 0x31F },  //4x32
    { 0, 0x3F, 0x300, 0x33F },  //4x64
    { 0, 3, 0x700, 0x703 },     //8x4
    { 0, 7, 0x700, 0x707 },     //8x8
    { 0, 0xF, 0x700, 0x70F },   //8x16
    { 0, 0x1F, 0x700, 0x71F },  //8x32
    { 0, 0x3F, 0x700, 0x73F },  //8x64
    { 0, 3, 0xF00, 0xF03 },     //16x4
    { 0, 7, 0xF00, 0xF07 },     //16x8
    { 0, 0xF, 0xF00, 0xF0F },   //16x16
    { 0, 0x1F, 0xF00, 0xF1F },  //16x32
    { 0, 0x3F, 0xF00, 0xF3F },  //16x64
    { 0, 3, 0x1F00, 0x1F03 },   //32x4
    { 0, 7, 0x1F00, 0x1F07 },   //32x8
    { 0, 0xF, 0x1F00, 0x1F0F }, //32x16
    { 0, 0x1F, 0x1F00, 0x1F1F },//32x32 
    { 0, 0x3F, 0x1F00, 0x1F3F },//32x64 
    { 0, 3, 0x3F00, 0x3F03 },   //64x4
    { 0, 7, 0x3F00, 0x3F07 },   //64x8
    { 0, 0xF, 0x3F00, 0x3F0F }, //64x16
    { 0, 0x1F, 0x3F00, 0x3F1F },//64x32
    { 0, 0x3F, 0x3F00, 0x3F3F },//64x64
    
    //upper left right triangle xflip?[(0,0)-(0,y)-(x,0)-(x,y)]
    { 0, 0x300, 3, 0x303 },     //4x4  
    { 0, 0x300, 7, 0x307 },     //4x8
    { 0, 0x300, 0xF, 0x30F },   //4x16
    { 0, 0x300, 0x1F, 0x31F },  //4x32
    { 0, 0x300, 0x3F, 0x33F },  //4x64
    { 0, 0x700, 3, 0x703 },     //8x4
    { 0, 0x700, 7, 0x707 },     //8x8
    { 0, 0x700, 0xF, 0x70F },   //8x16
    { 0, 0x700, 0x1F, 0x71F },  //8x32
    { 0, 0x700, 0x3F, 0x73F },  //8x64
    { 0, 0xF00, 3, 0xF03 },     //16x4
    { 0, 0xF00, 7, 0xF07 },     //16x8
    { 0, 0xF00, 0xF, 0xF0F },   //16x16
    { 0, 0xF00, 0x1F, 0xF1F },  //16x32
    { 0, 0xF00, 0x3F, 0xF3F },  //16x64
    { 0, 0x1F00, 3, 0x1F03 },   //32x4
    { 0, 0x1F00, 7, 0x1F07 },   //32x8
    { 0, 0x1F00, 0xF, 0x1F0F }, //32x16
    { 0, 0x1F00, 0x1F, 0x1F1F },//32x32
    { 0, 0x1F00, 0x3F, 0x1F3F },//32x64
    { 0, 0x3F00, 3, 0x3F03 },   //64x4
    { 0, 0x3F00, 7, 0x3F07 },   //64x8
    { 0, 0x3F00, 0xF, 0x3F0F }, //64x16
    { 0, 0x3F00, 0x1F, 0x3F1F },//64x32
    { 0, 0x3F00, 0x3F, 0x3F3F },//64x64
    
    //upper left right triangle yflip?[(x,0)-(0,y)-(0,0)]
    { 3, 0x300, 0, 0x6363 },    //4x4  
    { 7, 0x300, 0, 0x6363 },    //4x8
    { 0xF, 0x300, 0, 0x6363 },  //4x16
    { 0x1F, 0x300, 0, 0x6363 }, //4x32
    { 0x3F, 0x300, 0, 0x6363 }, //4x64
    { 3, 0x700, 0, 0x6363 },    //8x4
    { 7, 0x700, 0, 0x6363 },    //8x8
    { 0xF, 0x700, 0, 0x6363 },  //8x16
    { 0x1F, 0x700, 0, 0x6363 }, //8x32
    { 0x3F, 0x700, 0, 0x6363 }, //8x64
    { 3, 0xF00, 0, 0x6363 },    //16x4
    { 7, 0xF00, 0, 0x6363 },    //16x8
    { 0xF, 0xF00, 0, 0x6363 },  //16x16
    { 0x1F, 0xF00, 0, 0x6363 }, //16x32
    { 0x3F, 0xF00, 0, 0x6363 }, //16x64
    { 3, 0x1F00, 0, 0x6363 },   //32x4
    { 7, 0x1F00, 0, 0x6363 },   //32x8
    { 0xF, 0x1F00, 0, 0x6363 }, //32x16
    { 0x1F, 0x1F00, 0, 0x6363 },//32x32
    { 0x3F, 0x1F00, 0, 0x6363 },//32x64
    { 3, 0x3F00, 0, 0x6363 },   //64x4
    { 7, 0x3F00, 0, 0x6363 },   //64x8
    { 0xF, 0x3F00, 0, 0x6363 }, //64x16
    { 0x1F, 0x3F00, 0, 0x6363 },//64x32
    { 0x3F, 0x3F00, 0, 0x6363 },//64x64
    
    //upper left right triangle xyflip?[(x,0)-(0,0)-(0,y)]
    { 3, 0, 0x300, 0x6363 },    //4x4  
    { 7, 0, 0x300, 0x6363 },    //4x8
    { 0xF, 0, 0x300, 0x6363 },  //4x16
    { 0x1F, 0, 0x300, 0x6363 }, //4x32
    { 0x3F, 0, 0x300, 0x6363 }, //4x64
    { 3, 0, 0x700, 0x6363 },    //8x4
    { 7, 0, 0x700, 0x6363 },    //8x8
    { 0xF, 0, 0x700, 0x6363 },  //8x16
    { 0x1F, 0, 0x700, 0x6363 }, //8x32
    { 0x3F, 0, 0x700, 0x6363 }, //8x64
    { 3, 0, 0xF00, 0x6363 },    //16x4
    { 7, 0, 0xF00, 0x6363 },    //16x8
    { 0xF, 0, 0xF00, 0x6363 },  //16x16
    { 0x1F, 0, 0xF00, 0x6363 }, //16x32
    { 0x3F, 0, 0xF00, 0x6363 }, //16x64
    { 3, 0, 0x1F00, 0x6363 },   //32x4
    { 7, 0, 0x1F00, 0x6363 },   //32x8
    { 0xF, 0, 0x1F00, 0x6363 }, //32x16
    { 0x1F, 0, 0x1F00, 0x6363 },//32x32
    { 0x3F, 0, 0x1F00, 0x6363 },//32x64
    { 3, 0, 0x3F00, 0x6363 },   //64x4
    { 7, 0, 0x3F00, 0x6363 },   //64x8
    { 0xF, 0, 0x3F00, 0x6363 }, //64x16
    { 0x1F, 0, 0x3F00, 0x6363 },//64x32
    { 0x3F, 0, 0x3F00, 0x6363 },//64x64
    
    //upper left right triangle [(0,y)-(0,0)-(x,0)]
    { 0x300, 0, 3, 0x6363 },    //4x4  
    { 0x300, 0, 7, 0x6363 },    //4x8
    { 0x300, 0, 0xF, 0x6363 },  //4x16
    { 0x300, 0, 0x1F, 0x6363 }, //4x32
    { 0x300, 0, 0x3F, 0x6363 }, //4x64
    { 0x700, 0, 3, 0x6363 },    //8x4
    { 0x700, 0, 7, 0x6363 },    //8x8
    { 0x700, 0, 0xF, 0x6363 },  //8x16
    { 0x700, 0, 0x1F, 0x6363 }, //8x32
    { 0x700, 0, 0x3F, 0x6363 }, //8x64
    { 0xF00, 0, 3, 0x6363 },    //16x4
    { 0xF00, 0, 7, 0x6363 },    //16x8
    { 0xF00, 0, 0xF, 0x6363 },  //16x16
    { 0xF00, 0, 0x1F, 0x6363 }, //16x32
    { 0xF00, 0, 0x3F, 0x6363 }, //16x64
    { 0x1F00, 0, 3, 0x6363 },   //32x4
    { 0x1F00, 0, 7, 0x6363 },   //32x8
    { 0x1F00, 0, 0xF, 0x6363 }, //32x16
    { 0x1F00, 0, 0x1F, 0x6363 },//32x32
    { 0x1F00, 0, 0x3F, 0x6363 },//32x64
    { 0x3F00, 0, 3, 0x6363 },   //64x4
    { 0x3F00, 0, 7, 0x6363 },   //64x8
    { 0x3F00, 0, 0xF, 0x6363 }, //64x16
    { 0x3F00, 0, 0x1F, 0x6363 },//64x32
    { 0x3F00, 0, 0x3F, 0x6363 },//64x64
    
    //upper left right triangle[(0,y)-(x,0)-(0,0)]  0yx__0
    { 0x300, 3, 0, 0x6363 },    //4x4  
    { 0x300, 7, 0, 0x6363 },    //4x8
    { 0x300, 0xF, 0, 0x6363 },  //4x16
    { 0x300, 0x1F, 0, 0x6363 }, //4x32
    { 0x300, 0x3F, 0, 0x6363 }, //4x64
    { 0x700, 3, 0, 0x6363 },    //8x4
    { 0x700, 7, 0, 0x6363 },    //8x8
    { 0x700, 0xF, 0, 0x6363 },  //8x16
    { 0x700, 0x1F, 0, 0x6363 }, //8x32
    { 0x700, 0x3F, 0, 0x6363 }, //8x64
    { 0xF00, 3, 0, 0x6363 },    //16x4
    { 0xF00, 7, 0, 0x6363 },    //16x8
    { 0xF00, 0xF, 0, 0x6363 },  //16x16
    { 0xF00, 0x1F, 0, 0x6363 }, //16x32
    { 0xF00, 0x3F, 0, 0x6363 }, //16x64
    { 0x1F00, 3, 0, 0x6363 },   //32x4
    { 0x1F00, 7, 0, 0x6363 },   //32x8
    { 0x1F00, 0xF, 0, 0x6363 }, //32x16
    { 0x1F00, 0x1F, 0, 0x6363 },//32x32
    { 0x1F00, 0x3F, 0, 0x6363 },//32x64
    { 0x3F00, 3, 0, 0x6363 },   //64x4
    { 0x3F00, 7, 0, 0x6363 },   //64x8
    { 0x3F00, 0xF, 0, 0x6363 }, //64x16
    { 0x3F00, 0x1F, 0, 0x6363 },//64x32
    { 0x3F00, 0x3F, 0, 0x6363 },//64x64
    
    //upper right right triangle [(0,0)-(x,0)-(x,y)]
    { 0, 3, 0x303, 0x6363 },    //4x4  
    { 0, 7, 0x307, 0x6363 },    //4x8
    { 0, 0xF, 0x30F, 0x6363 },  //4x16
    { 0, 0x1F, 0x31F, 0x6363 }, //4x32
    { 0, 0x3F, 0x33F, 0x6363 }, //4x64
    { 0, 3, 0x703, 0x6363 },    //8x4
    { 0, 7, 0x707, 0x6363 },    //8x8
    { 0, 0xF, 0x70F, 0x6363 },  //8x16
    { 0, 0x1F, 0x71F, 0x6363 }, //8x32
    { 0, 0x3F, 0x73F, 0x6363 }, //8x64
    { 0, 3, 0xF03, 0x6363 },    //16x4
    { 0, 7, 0xF07, 0x6363 },    //16x8
    { 0, 0xF, 0xF0F, 0x6363 },  //16x16
    { 0, 0x1F, 0xF1F, 0x6363 }, //16x32
    { 0, 0x3F, 0xF3F, 0x6363 }, //16x64
    { 0, 3, 0x1F03, 0x6363 },   //32x4
    { 0, 7, 0x1F07, 0x6363 },   //32x8
    { 0, 0xF, 0x1F0F, 0x6363 }, //32x16
    { 0, 0x1F, 0x1F1F, 0x6363 },//32x32
    { 0, 0x3F, 0x1F3F, 0x6363 },//32x64
    { 0, 3, 0x3F03, 0x6363 },   //64x4
    { 0, 7, 0x3F07, 0x6363 },   //64x8
    { 0, 0xF, 0x3F0F, 0x6363 }, //64x16
    { 0, 0x1F, 0x3F1F, 0x6363 },//64x32
    { 0, 0x3F, 0x3F3F, 0x6363 },//64x64
    
    //upper right right triangle [(0,0)-(x,y)-(x,0)]
    { 0, 0x303, 3, 0x6363 },    //4x4  
    { 0, 0x307, 7, 0x6363 },    //4x8
    { 0, 0x30F, 0xF, 0x6363 },  //4x16
    { 0, 0x31F, 0x1F, 0x6363 }, //4x32
    { 0, 0x33F, 0x3F, 0x6363 }, //4x64
    { 0, 0x703, 3, 0x6363 },    //8x4
    { 0, 0x707, 7, 0x6363 },    //8x8
    { 0, 0x70F, 0xF, 0x6363 },  //8x16
    { 0, 0x71F, 0x1F, 0x6363 }, //8x32
    { 0, 0x73F, 0x3F, 0x6363 }, //8x64
    { 0, 0xF03, 3, 0x6363 },    //16x4
    { 0, 0xF07, 7, 0x6363 },    //16x8
    { 0, 0xF0F, 0xF, 0x6363 },  //16x16
    { 0, 0xF1F, 0x1F, 0x6363 }, //16x32
    { 0, 0xF3F, 0x3F, 0x6363 }, //16x64
    { 0, 0x1F03, 3, 0x6363 },   //32x4
    { 0, 0x1F07, 7, 0x6363 },   //32x8
    { 0, 0x1F0F, 0xF, 0x6363 }, //32x16
    { 0, 0x1F1F, 0x1F, 0x6363 },//32x32
    { 0, 0x1F3F, 0x3F, 0x6363 },//32x64
    { 0, 0x3F03, 3, 0x6363 },   //64x4
    { 0, 0x3F07, 7, 0x6363 },   //64x8
    { 0, 0x3F0F, 0xF, 0x6363 }, //64x16
    { 0, 0x3F1F, 0x1F, 0x6363 },//64x32
    { 0, 0x3F3F, 0x3F, 0x6363 },//64x64
    
    //upper right right triangle [(x,0)-(x,y)-(0,0)]
    { 3, 0x303, 0, 0x300 },     //4x4  
    { 7, 0x307, 0, 0x300 },     //4x8
    { 0xF, 0x30F, 0, 0x300 },   //4x16
    { 0x1F, 0x31F, 0, 0x300 },  //4x32
    { 0x3F, 0x33F, 0, 0x300 },  //4x64
    { 3, 0x703, 0, 0x700 },     //8x4
    { 7, 0x707, 0, 0x700 },     //8x8
    { 0xF, 0x70F, 0, 0x700 },   //8x16
    { 0x1F, 0x71F, 0, 0x700 },  //8x32
    { 0x3F, 0x73F, 0, 0x700 },  //8x64
    { 3, 0xF03, 0, 0xF00 },     //16x4
    { 7, 0xF07, 0, 0xF00 },     //16x8
    { 0xF, 0xF0F, 0, 0xF00 },   //16x16
    { 0x1F, 0xF1F, 0, 0xF00 },  //16x32
    { 0x3F, 0xF3F, 0, 0xF00 },  //16x64
    { 3, 0x1F03, 0, 0x1F00 },   //32x4
    { 7, 0x1F07, 0, 0x1F00 },   //32x8
    { 0xF, 0x1F0F, 0, 0x1F00 }, //32x16
    { 0x1F, 0x1F1F, 0, 0x1F00 },//32x32
    { 0x3F, 0x1F3F, 0, 0x1F00 },//32x64
    { 3, 0x3F03, 0, 0x3F00 },   //64x4
    { 7, 0x3F07, 0, 0x3F00 },   //64x8
    { 0xF, 0x3F0F, 0, 0x3F00 }, //64x16
    { 0x1F, 0x3F1F, 0, 0x3F00 },//64x32
    { 0x3F, 0x3F3F, 0, 0x3F00 },//64x64
    
    //upper right right triangle [(x,0)-(0,0)-(x,y)]
    { 3, 0, 0x303, 0x300 },     //4x4  
    { 7, 0, 0x307, 0x300 },     //4x8
    { 0xF, 0, 0x30F, 0x300 },   //4x16
    { 0x1F, 0, 0x31F, 0x300 },  //4x32
    { 0x3F, 0, 0x33F, 0x300 },  //4x64
    { 3, 0, 0x703, 0x700 },     //8x4
    { 7, 0, 0x707, 0x700 },     //8x8
    { 0xF, 0, 0x70F, 0x700 },   //8x16
    { 0x1F, 0, 0x71F, 0x700 },  //8x32
    { 0x3F, 0, 0x73F, 0x700 },  //8x64
    { 3, 0, 0xF03, 0xF00 },     //16x4
    { 7, 0, 0xF07, 0xF00 },     //16x8
    { 0xF, 0, 0xF0F, 0xF00 },   //16x16
    { 0x1F, 0, 0xF1F, 0xF00 },  //16x32
    { 0x3F, 0, 0xF3F, 0xF00 },  //16x64
    { 3, 0, 0x1F03, 0x1F00 },   //32x4
    { 7, 0, 0x1F07, 0x1F00 },   //32x8
    { 0xF, 0, 0x1F0F, 0x1F00 }, //32x16
    { 0x1F, 0, 0x1F1F, 0x1F00 },//32x32
    { 0x3F, 0, 0x1F3F, 0x1F00 },//32x64
    { 3, 0, 0x3F03, 0x3F00 },   //64x4
    { 7, 0, 0x3F07, 0x3F00 },   //64x8
    { 0xF, 0, 0x3F0F, 0x3F00 }, //64x16
    { 0x1F, 0, 0x3F1F, 0x3F00 },//64x32
    { 0x3F, 0, 0x3F3F, 0x3F00 },//64x64
    
    //upper right right triangle [(x,y)-(0,0)-(x,0)]
    { 0x303, 0, 3, 0x6363 },    //4x4  
    { 0x307, 0, 7, 0x6363 },    //4x8
    { 0x30F, 0, 0xF, 0x6363 },  //4x16
    { 0x31F, 0, 0x1F, 0x6363 }, //4x32
    { 0x33F, 0, 0x3F, 0x6363 }, //4x64
    { 0x703, 0, 3, 0x6363 },    //8x4
    { 0x707, 0, 7, 0x6363 },    //8x8
    { 0x70F, 0, 0xF, 0x6363 },  //8x16
    { 0x71F, 0, 0x1F, 0x6363 }, //8x32
    { 0x73F, 0, 0x3F, 0x6363 }, //8x64
    { 0xF03, 0, 3, 0x6363 },    //16x4
    { 0xF07, 0, 7, 0x6363 },    //16x8
    { 0xF0F, 0, 0xF, 0x6363 },  //16x16
    { 0xF1F, 0, 0x1F, 0x6363 }, //16x32
    { 0xF3F, 0, 0x3F, 0x6363 }, //16x64
    { 0x1F03, 0, 3, 0x6363 },   //32x4
    { 0x1F07, 0, 7, 0x6363 },   //32x8
    { 0x1F0F, 0, 0xF, 0x6363 }, //32x16
    { 0x1F1F, 0, 0x1F, 0x6363 },//32x32
    { 0x1F3F, 0, 0x3F, 0x6363 },//32x64
    { 0x3F03, 0, 3, 0x6363 },   //64x4
    { 0x3F07, 0, 7, 0x6363 },   //64x8
    { 0x3F0F, 0, 0xF, 0x6363 }, //64x16
    { 0x3F1F, 0, 0x1F, 0x6363 },//64x32
    { 0x3F3F, 0, 0x3F, 0x6363 },//64x64
    
    //upper right right triangle [(x,y)-(x,0)-(0,0)]
    { 0x303, 3, 0, 0x6363 },    //4x4  
    { 0x307, 7, 0, 0x6363 },    //4x8
    { 0x30F, 0xF, 0, 0x6363 },  //4x16
    { 0x31F, 0x1F, 0, 0x6363 }, //4x32
    { 0x33F, 0x3F, 0, 0x6363 }, //4x64
    { 0x703, 3, 0, 0x6363 },    //8x4
    { 0x707, 7, 0, 0x6363 },    //8x8
    { 0x70F, 0xF, 0, 0x6363 },  //8x16
    { 0x71F, 0x1F, 0, 0x6363 }, //8x32
    { 0x73F, 0x3F, 0, 0x6363 }, //8x64
    { 0xF03, 3, 0, 0x6363 },    //16x4
    { 0xF07, 7, 0, 0x6363 },    //16x8
    { 0xF0F, 0xF, 0, 0x6363 },  //16x16
    { 0xF1F, 0x1F, 0, 0x6363 }, //16x32
    { 0xF3F, 0x3F, 0, 0x6363 }, //16x64
    { 0x1F03, 3, 0, 0x6363 },   //32x4
    { 0x1F07, 7, 0, 0x6363 },   //32x8
    { 0x1F0F, 0xF, 0, 0x6363 }, //32x16
    { 0x1F1F, 0x1F, 0, 0x6363 },//32x32
    { 0x1F3F, 0x3F, 0, 0x6363 },//32x64
    { 0x3F03, 3, 0, 0x6363 },   //64x4
    { 0x3F07, 7, 0, 0x6363 },   //64x8
    { 0x3F0F, 0xF, 0, 0x6363 }, //64x16
    { 0x3F1F, 0x1F, 0, 0x6363 },//64x32
    { 0x3F3F, 0x3F, 0, 0x6363 },//64x64
    
    //lower right right triangle [(x,0)-(x,y)-(0,y)]
    { 3, 0x303, 0x300, 0x6363 },     //4x4  
    { 7, 0x307, 0x300, 0x6363 },     //4x8
    { 0xF, 0x30F, 0x300, 0x6363 },   //4x16
    { 0x1F, 0x31F, 0x300, 0x6363 },  //4x32
    { 0x3F, 0x33F, 0x300, 0x6363 },  //4x64
    { 3, 0x703, 0x700, 0x6363 },     //8x4
    { 7, 0x707, 0x700, 0x6363 },     //8x8
    { 0xF, 0x70F, 0x700, 0x6363 },   //8x16
    { 0x1F, 0x71F, 0x700, 0x6363 },  //8x32
    { 0x3F, 0x73F, 0x700, 0x6363 },  //8x64
    { 3, 0xF03, 0xF00, 0x6363 },     //16x4
    { 7, 0xF07, 0xF00, 0x6363 },     //16x8
    { 0xF, 0xF0F, 0xF00, 0x6363 },   //16x16
    { 0x1F, 0xF1F, 0xF00, 0x6363 },  //16x32
    { 0x3F, 0xF3F, 0xF00, 0x6363 },  //16x64
    { 3, 0x1F03, 0x1F00, 0x6363 },   //32x4
    { 7, 0x1F07, 0x1F00, 0x6363 },   //32x8
    { 0xF, 0x1F0F, 0x1F00, 0x6363 }, //32x16
    { 0x1F, 0x1F1F, 0x1F00, 0x6363 },//32x32
    { 0x3F, 0x1F3F, 0x1F00, 0x6363 },//32x64
    { 3, 0x3F03, 0x3F00, 0x6363 },   //64x4
    { 7, 0x3F07, 0x3F00, 0x6363 },   //64x8
    { 0xF, 0x3F0F, 0x3F00, 0x6363 }, //64x16
    { 0x1F, 0x3F1F, 0x3F00, 0x6363 },//64x32
    { 0x3F, 0x3F3F, 0x3F00, 0x6363 },//64x64
    
    //lower right right triangle [(x,0)-(0,y)-(x,y)]  **
    { 3, 0x300, 0x303, 0x6363 },     //4x4  
    { 7, 0x300, 0x307, 0x6363 },     //4x8
    { 0xF, 0x300, 0x30F, 0x6363 },   //4x16
    { 0x1F, 0x300, 0x31F, 0x6363 },  //4x32
    { 0x3F, 0x300, 0x33F, 0x6363 },  //4x64
    { 3, 0x700, 0x703, 0x6363 },     //8x4
    { 7, 0x700, 0x707, 0x6363 },     //8x8
    { 0xF, 0x700, 0x70F, 0x6363 },   //8x16
    { 0x1F, 0x700, 0x71F, 0x6363 },  //8x32
    { 0x3F, 0x700, 0x73F, 0x6363 },  //8x64
    { 3, 0xF00, 0xF03, 0x6363 },     //16x4
    { 7, 0xF00, 0xF07, 0x6363 },     //16x8
    { 0xF, 0xF00, 0xF0F, 0x6363 },   //16x16
    { 0x1F, 0xF00, 0xF1F, 0x6363 },  //16x32
    { 0x3F, 0xF00, 0xF3F, 0x6363 },  //16x64
    { 3, 0x1F00, 0x1F03, 0x6363 },   //32x4
    { 7, 0x1F00, 0x1F07, 0x6363 },   //32x8
    { 0xF, 0x1F00, 0x1F0F, 0x6363 }, //32x16
    { 0x1F, 0x1F00, 0x1F1F, 0x6363 },//32x32
    { 0x3F, 0x1F00, 0x1F3F, 0x6363 },//32x64
    { 3, 0x3F00, 0x3F03, 0x6363 },   //64x4
    { 7, 0x3F00, 0x3F07, 0x6363 },   //64x8
    { 0xF, 0x3F00, 0x3F0F, 0x6363 }, //64x16
    { 0x1F, 0x3F00, 0x3F1F, 0x6363 },//64x32
    { 0x3F, 0x3F00, 0x3F3F, 0x6363 },//64x64
    
    //lower right right triangle [(x,y)-(0,y)-(x,0)]
    { 0x303, 0x300, 3, 0 },     //4x4  
    { 0x307, 0x300, 7, 0 },     //4x8
    { 0x30F, 0x300, 0xF, 0 },   //4x16
    { 0x31F, 0x300, 0x1F, 0 },  //4x32
    { 0x33F, 0x300, 0x3F, 0 },  //4x64
    { 0x703, 0x700, 3, 0 },     //8x4
    { 0x707, 0x700, 7, 0 },     //8x8
    { 0x70F, 0x700, 0xF, 0 },   //8x16
    { 0x71F, 0x700, 0x1F, 0 },  //8x32
    { 0x73F, 0x700, 0x3F, 0 },  //8x64
    { 0xF03, 0xF00, 3, 0 },     //16x4
    { 0xF07, 0xF00, 7, 0 },     //16x8
    { 0xF0F, 0xF00, 0xF, 0 },   //16x16
    { 0xF1F, 0xF00, 0x1F, 0 },  //16x32
    { 0xF3F, 0xF00, 0x3F, 0 },  //16x64
    { 0x1F03, 0x1F00, 3, 0 },   //32x4
    { 0x1F07, 0x1F00, 7, 0 },   //32x8
    { 0x1F0F, 0x1F00, 0xF, 0 }, //32x16
    { 0x1F1F, 0x1F00, 0x1F, 0 },//32x32
    { 0x1F3F, 0x1F00, 0x3F, 0 },//32x64
    { 0x3F03, 0x3F00, 3, 0 },   //64x4
    { 0x3F07, 0x3F00, 7, 0 },   //64x8
    { 0x3F0F, 0x3F00, 0xF, 0 }, //64x16
    { 0x3F1F, 0x3F00, 0x1F, 0 },//64x32
    { 0x3F3F, 0x3F00, 0x3F, 0 },//64x64
    
    //lower right right triangle [(x,y)-(x,0)-(0,y)]
    { 0x303, 3, 0x300, 0 },     //4x4  
    { 0x307, 7, 0x300, 0 },     //4x8
    { 0x30F, 0xF, 0x300, 0 },   //4x16
    { 0x31F, 0x1F, 0x300, 0 },  //4x32
    { 0x33F, 0x3F, 0x300, 0 },  //4x64
    { 0x703, 3, 0x700, 0 },     //8x4
    { 0x707, 7, 0x700, 0 },     //8x8
    { 0x70F, 0xF, 0x700, 0 },   //8x16
    { 0x71F, 0x1F, 0x700, 0 },  //8x32
    { 0x73F, 0x3F, 0x700, 0 },  //8x64
    { 0xF03, 3, 0xF00, 0 },     //16x4
    { 0xF07, 7, 0xF00, 0 },     //16x8
    { 0xF0F, 0xF, 0xF00, 0 },   //16x16
    { 0xF1F, 0x1F, 0xF00, 0 },  //16x32
    { 0xF3F, 0x3F, 0xF00, 0 },  //16x64
    { 0x1F03, 3, 0x1F00, 0 },   //32x4
    { 0x1F07, 7, 0x1F00, 0 },   //32x8
    { 0x1F0F, 0xF, 0x1F00, 0 }, //32x16
    { 0x1F1F, 0x1F, 0x1F00, 0 },//32x32
    { 0x1F3F, 0x3F, 0x1F00, 0 },//32x64
    { 0x3F03, 3, 0x3F00, 0 },   //64x4
    { 0x3F07, 7, 0x3F00, 0 },   //64x8
    { 0x3F0F, 0xF, 0x3F00, 0 }, //64x16
    { 0x3F1F, 0x1F, 0x3F00, 0 },//64x32
    { 0x3F3F, 0x3F, 0x3F00, 0 },//64x64
    
    //lower right right triangle [(0,y)-(x,0)-(x,y)]
    { 0x300, 3, 0x303, 0x6363 },     //4x4  
    { 0x300, 7, 0x307, 0x6363 },     //4x8
    { 0x300, 0xF, 0x30F, 0x6363 },   //4x16
    { 0x300, 0x1F, 0x31F, 0x6363 },  //4x32
    { 0x300, 0x3F, 0x33F, 0x6363 },  //4x64
    { 0x700, 3, 0x703, 0x6363 },     //8x4
    { 0x700, 7, 0x707, 0x6363 },     //8x8
    { 0x700, 0xF, 0x70F, 0x6363 },   //8x16
    { 0x700, 0x1F, 0x71F, 0x6363 },  //8x32
    { 0x700, 0x3F, 0x73F, 0x6363 },  //8x64
    { 0xF00, 3, 0xF03, 0x6363 },     //16x4
    { 0xF00, 7, 0xF07, 0x6363 },     //16x8
    { 0xF00, 0xF, 0xF0F, 0x6363 },   //16x16
    { 0xF00, 0x1F, 0xF1F, 0x6363 },  //16x32
    { 0xF00, 0x3F, 0xF3F, 0x6363 },  //16x64
    { 0x1F00, 3, 0x1F03, 0x6363 },   //32x4
    { 0x1F00, 7, 0x1F07, 0x6363 },   //32x8
    { 0x1F00, 0xF, 0x1F0F, 0x6363 }, //32x16
    { 0x1F00, 0x1F, 0x1F1F, 0x6363 },//32x32
    { 0x1F00, 0x3F, 0x1F3F, 0x6363 },//32x64
    { 0x3F00, 3, 0x3F03, 0x6363 },   //64x4
    { 0x3F00, 7, 0x3F07, 0x6363 },   //64x8
    { 0x3F00, 0xF, 0x3F0F, 0x6363 }, //64x16
    { 0x3F00, 0x1F, 0x3F1F, 0x6363 },//64x32
    { 0x3F00, 0x3F, 0x3F3F, 0x6363 },//64x64
    
    //lower right right triangle [(0,y)-(x,y)-(x,0)] 0yx__0
    { 0x300, 0x303, 3, 0x6363 },     //4x4  
    { 0x300, 0x307, 7, 0x6363 },     //4x8
    { 0x300, 0x30F, 0xF, 0x6363 },   //4x16
    { 0x300, 0x31F, 0x1F, 0x6363 },  //4x32
    { 0x300, 0x33F, 0x3F, 0x6363 },  //4x64
    { 0x700, 0x703, 3, 0x6363 },     //8x4
    { 0x700, 0x707, 7, 0x6363 },     //8x8
    { 0x700, 0x70F, 0xF, 0x6363 },   //8x16
    { 0x700, 0x71F, 0x1F, 0x6363 },  //8x32
    { 0x700, 0x73F, 0x3F, 0x6363 },  //8x64
    { 0xF00, 0xF03, 3, 0x6363 },     //16x4
    { 0xF00, 0xF07, 7, 0x6363 },     //16x8
    { 0xF00, 0xF0F, 0xF, 0x6363 },   //16x16
    { 0xF00, 0xF1F, 0x1F, 0x6363 },  //16x32
    { 0xF00, 0xF3F, 0x3F, 0x6363 },  //16x64
    { 0x1F00, 0x1F03, 3, 0x6363 },   //32x4
    { 0x1F00, 0x1F07, 7, 0x6363 },   //32x8
    { 0x1F00, 0x1F0F, 0xF, 0x6363 }, //32x16
    { 0x1F00, 0x1F1F, 0x1F, 0x6363 },//32x32
    { 0x1F00, 0x1F3F, 0x3F, 0x6363 },//32x64
    { 0x3F00, 0x3F03, 3, 0x6363 },   //64x4
    { 0x3F00, 0x3F07, 7, 0x6363 },   //64x8
    { 0x3F00, 0x3F0F, 0xF, 0x6363 }, //64x16
    { 0x3F00, 0x3F1F, 0x1F, 0x6363 },//64x32
    { 0x3F00, 0x3F3F, 0x3F, 0x6363 },//64x64
    
    //lower left right triangle [(0,0)-(x,y)-(0,y)]
    { 0, 0x303, 0x300, 0x6363 },  //4x4  
    { 0, 0x307, 0x300, 0x6363 },  //4x8
    { 0, 0x30F, 0x300, 0x6363 },  //4x16
    { 0, 0x31F, 0x300, 0x6363 },  //4x32
    { 0, 0x33F, 0x300, 0x6363 },  //4x64
    { 0, 0x703, 0x700, 0x6363 },  //8x4
    { 0, 0x707, 0x700, 0x6363 },  //8x8
    { 0, 0x70F, 0x700, 0x6363 },  //8x16
    { 0, 0x71F, 0x700, 0x6363 },  //8x32
    { 0, 0x73F, 0x700, 0x6363 },  //8x64
    { 0, 0xF03, 0xF00, 0x6363 },  //16x4
    { 0, 0xF07, 0xF00, 0x6363 },  //16x8
    { 0, 0xF0F, 0xF00, 0x6363 },  //16x16
    { 0, 0xF1F, 0xF00, 0x6363 },  //16x32
    { 0, 0xF3F, 0xF00, 0x6363 },  //16x64
    { 0, 0x1F03, 0x1F00, 0x6363 },//32x4
    { 0, 0x1F07, 0x1F00, 0x6363 },//32x8
    { 0, 0x1F0F, 0x1F00, 0x6363 },//32x16
    { 0, 0x1F1F, 0x1F00, 0x6363 },//32x32
    { 0, 0x1F3F, 0x1F00, 0x6363 },//32x64
    { 0, 0x3F03, 0x3F00, 0x6363 },//64x4
    { 0, 0x3F07, 0x3F00, 0x6363 },//64x8
    { 0, 0x3F0F, 0x3F00, 0x6363 },//64x16
    { 0, 0x3F1F, 0x3F00, 0x6363 },//64x32
    { 0, 0x3F3F, 0x3F00, 0x6363 },//64x64
    
    //lower left right triangle [(0,0)-(0,y)-(x,y)]   ****
    { 0, 0x300, 0x303, 0x6363 },  //4x4  
    { 0, 0x300, 0x307, 0x6363 },  //4x8
    { 0, 0x300, 0x30F, 0x6363 },  //4x16
    { 0, 0x300, 0x31F, 0x6363 },  //4x32
    { 0, 0x300, 0x33F, 0x6363 },  //4x64
    { 0, 0x700, 0x703, 0x6363 },  //8x4
    { 0, 0x700, 0x707, 0x6363 },  //8x8
    { 0, 0x700, 0x70F, 0x6363 },  //8x16
    { 0, 0x700, 0x71F, 0x6363 },  //8x32
    { 0, 0x700, 0x73F, 0x6363 },  //8x64
    { 0, 0xF00, 0xF03, 0x6363 },  //16x4
    { 0, 0xF00, 0xF07, 0x6363 },  //16x8
    { 0, 0xF00, 0xF0F, 0x6363 },  //16x16
    { 0, 0xF00, 0xF1F, 0x6363 },  //16x32
    { 0, 0xF00, 0xF3F, 0x6363 },  //16x64
    { 0, 0x1F00, 0x1F03, 0x6363 },//32x4
    { 0, 0x1F00, 0x1F07, 0x6363 },//32x8
    { 0, 0x1F00, 0x1F0F, 0x6363 },//32x16
    { 0, 0x1F00, 0x1F1F, 0x6363 },//32x32
    { 0, 0x1F00, 0x1F3F, 0x6363 },//32x64
    { 0, 0x3F00, 0x3F03, 0x6363 },//64x4
    { 0, 0x3F00, 0x3F07, 0x6363 },//64x8
    { 0, 0x3F00, 0x3F0F, 0x6363 },//64x16
    { 0, 0x3F00, 0x3F1F, 0x6363 },//64x32
    { 0, 0x3F00, 0x3F3F, 0x6363 },//64x64
    
    //lower left right triangle [(x,y)-(0,y)-(0,0)]
    { 0x303, 0x300, 0, 0x6363 },  //4x4  
    { 0x307, 0x300, 0, 0x6363 },  //4x8
    { 0x30F, 0x300, 0, 0x6363 },  //4x16
    { 0x31F, 0x300, 0, 0x6363 },  //4x32
    { 0x33F, 0x300, 0, 0x6363 },  //4x64
    { 0x703, 0x700, 0, 0x6363 },  //8x4
    { 0x707, 0x700, 0, 0x6363 },  //8x8
    { 0x70F, 0x700, 0, 0x6363 },  //8x16
    { 0x71F, 0x700, 0, 0x6363 },  //8x32
    { 0x73F, 0x700, 0, 0x6363 },  //8x64
    { 0xF03, 0xF00, 0, 0x6363 },  //16x4
    { 0xF07, 0xF00, 0, 0x6363 },  //16x8
    { 0xF0F, 0xF00, 0, 0x6363 },  //16x16
    { 0xF1F, 0xF00, 0, 0x6363 },  //16x32
    { 0xF3F, 0xF00, 0, 0x6363 },  //16x64
    { 0x1F03, 0x1F00, 0, 0x6363 },//32x4
    { 0x1F07, 0x1F00, 0, 0x6363 },//32x8
    { 0x1F0F, 0x1F00, 0, 0x6363 },//32x16
    { 0x1F1F, 0x1F00, 0, 0x6363 },//32x32
    { 0x1F3F, 0x1F00, 0, 0x6363 },//32x64
    { 0x3F03, 0x3F00, 0, 0x6363 },//64x4
    { 0x3F07, 0x3F00, 0, 0x6363 },//64x8
    { 0x3F0F, 0x3F00, 0, 0x6363 },//64x16
    { 0x3F1F, 0x3F00, 0, 0x6363 },//64x32
    { 0x3F3F, 0x3F00, 0, 0x6363 },//64x64
    
    //lower left right triangle [(x,y)-(0,0)-(0,y)]
    { 0x303, 0, 0x300, 0x6363 },  //4x4  
    { 0x307, 0, 0x300, 0x6363 },  //4x8
    { 0x30F, 0, 0x300, 0x6363 },  //4x16
    { 0x31F, 0, 0x300, 0x6363 },  //4x32
    { 0x33F, 0, 0x300, 0x6363 },  //4x64
    { 0x703, 0, 0x700, 0x6363 },  //8x4
    { 0x707, 0, 0x700, 0x6363 },  //8x8
    { 0x70F, 0, 0x700, 0x6363 },  //8x16
    { 0x71F, 0, 0x700, 0x6363 },  //8x32
    { 0x73F, 0, 0x700, 0x6363 },  //8x64
    { 0xF03, 0, 0xF00, 0x6363 },  //16x4
    { 0xF07, 0, 0xF00, 0x6363 },  //16x8
    { 0xF0F, 0, 0xF00, 0x6363 },  //16x16
    { 0xF1F, 0, 0xF00, 0x6363 },  //16x32
    { 0xF3F, 0, 0xF00, 0x6363 },  //16x64
    { 0x1F03, 0, 0x1F00, 0x6363 },//32x4
    { 0x1F07, 0, 0x1F00, 0x6363 },//32x8
    { 0x1F0F, 0, 0x1F00, 0x6363 },//32x16
    { 0x1F1F, 0, 0x1F00, 0x6363 },//32x32
    { 0x1F3F, 0, 0x1F00, 0x6363 },//32x64
    { 0x3F03, 0, 0x3F00, 0x6363 },//64x4
    { 0x3F07, 0, 0x3F00, 0x6363 },//64x8
    { 0x3F0F, 0, 0x3F00, 0x6363 },//64x16
    { 0x3F1F, 0, 0x3F00, 0x6363 },//64x32
    { 0x3F3F, 0, 0x3F00, 0x6363 },//64x64
    
    //lower left right triangle [(0,y)-(0,0)-(x,y)]
    { 0x300, 0, 0x303, 3 },     //4x4  
    { 0x300, 0, 0x307, 7 },     //4x8
    { 0x300, 0, 0x30F, 0xF },   //4x16
    { 0x300, 0, 0x31F, 0x1F },  //4x32
    { 0x300, 0, 0x33F, 0x3F },  //4x64
    { 0x700, 0, 0x703, 3 },     //8x4
    { 0x700, 0, 0x707, 7 },     //8x8
    { 0x700, 0, 0x70F, 0xF },   //8x16
    { 0x700, 0, 0x71F, 0x1F },  //8x32
    { 0x700, 0, 0x73F, 0x3F },  //8x64
    { 0xF00, 0, 0xF03, 3 },     //16x4
    { 0xF00, 0, 0xF07, 7 },     //16x8
    { 0xF00, 0, 0xF0F, 0xF },   //16x16
    { 0xF00, 0, 0xF1F, 0x1F },  //16x32
    { 0xF00, 0, 0xF3F, 0x3F },  //16x64
    { 0x1F00, 0, 0x1F03, 3 },   //32x4
    { 0x1F00, 0, 0x1F07, 7 },   //32x8
    { 0x1F00, 0, 0x1F0F, 0xF }, //32x16
    { 0x1F00, 0, 0x1F1F, 0x1F },//32x32
    { 0x1F00, 0, 0x1F3F, 0x3F },//32x64
    { 0x3F00, 0, 0x3F03, 3 },   //64x4
    { 0x3F00, 0, 0x3F07, 7 },   //64x8
    { 0x3F00, 0, 0x3F0F, 0xF }, //64x16
    { 0x3F00, 0, 0x3F1F, 0x1F },//64x32
    { 0x3F00, 0, 0x3F3F, 0x3F },//64x64
    
    //lower left right triangle [(0,y)-(x,y)-(0,0)]  0yx__0
    { 0x300, 0x303, 0, 3 },     //4x4  
    { 0x300, 0x307, 0, 7 },     //4x8
    { 0x300, 0x30F, 0, 0xF },   //4x16
    { 0x300, 0x31F, 0, 0x1F },  //4x32
    { 0x300, 0x33F, 0, 0x3F },  //4x64
    { 0x700, 0x703, 0, 3 },     //8x4
    { 0x700, 0x707, 0, 7 },     //8x8
    { 0x700, 0x70F, 0, 0xF },   //8x16
    { 0x700, 0x71F, 0, 0x1F },  //8x32
    { 0x700, 0x73F, 0, 0x3F },  //8x64
    { 0xF00, 0xF03, 0, 3 },     //16x4
    { 0xF00, 0xF07, 0, 7 },     //16x8
    { 0xF00, 0xF0F, 0, 0xF },   //16x16
    { 0xF00, 0xF1F, 0, 0x1F },  //16x32
    { 0xF00, 0xF3F, 0, 0x3F },  //16x64
    { 0x1F00, 0x1F03, 0, 3 },   //32x4
    { 0x1F00, 0x1F07, 0, 7 },   //32x8
    { 0x1F00, 0x1F0F, 0, 0xF }, //32x16
    { 0x1F00, 0x1F1F, 0, 0x1F },//32x32 
    { 0x1F00, 0x1F3F, 0, 0x3F },//32x64 
    { 0x3F00, 0x3F03, 0, 3 },   //64x4
    { 0x3F00, 0x3F07, 0, 7 },   //64x8
    { 0x3F00, 0x3F0F, 0, 0xF }, //64x16
    { 0x3F00, 0x3F1F, 0, 0x1F },//64x32 
    { 0x3F00, 0x3F3F, 0, 0x3F } //64x64 
};

const point2 groupLocations[25] = { { 32,  32},   //4x4
                                    {  0,  96},   //4x8
                                    {  0, 160},   //4x16
                                    {  0, 288},   //4x32
                                    {  0, 544},   //4x64
                                    { 96,   0},   //8x4
                                    { 64,  64},   //8x8
                                    {  0, 192},   //8x16
                                    {  0, 320},   //8x32
                                    {  0, 576},   //8x64
                                    {160,   0},   //16x4
                                    {192,   0},   //16x8
                                    {128, 128},   //16x16
                                    {  0, 384},   //16x32
                                    {  0, 640},   //16x64
                                    {288,   0},   //32x4
                                    {320,   0},   //32x8
                                    {384,   0},   //32x16
                                    {256, 256}, //32x32
                                    {  0, 768},   //32x64
                                    {544,   0},   //64x4
                                    {576,   0},   //64x8
                                    {640,   0},   //64x16
                                    {768,   0},   //64x32
                                    {512, 512}}; //64x64
                                    
#endif




	